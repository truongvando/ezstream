================================================================================
ğŸ”‘ HÆ¯á»šNG DáºªN TÃCH Há»¢P LICENSE CHO PYTHON TOOLS - EZSTREAM SYSTEM
================================================================================

ğŸ“‹ Má»¤C Lá»¤C:
1. Tá»•ng quan há»‡ thá»‘ng License
2. CÃ¡ch hoáº¡t Ä‘á»™ng cá»§a License
3. Workflow tá»« Tool Store Ä‘áº¿n License
4. TÃ­ch há»£p vÃ o Python Tool
5. API Endpoints
6. Error Handling
7. Best Practices
8. Troubleshooting

================================================================================
1. ğŸ“Š Tá»”NG QUAN Há»† THá»NG LICENSE
================================================================================

ğŸ¯ Má»¤C ÄÃCH:
- Báº£o vá»‡ Python tools khá»i viá»‡c sá»­ dá»¥ng trÃ¡i phÃ©p
- RÃ ng buá»™c license vá»›i thiáº¿t bá»‹ cá»¥ thá»ƒ (device binding)
- Theo dÃµi vÃ  quáº£n lÃ½ viá»‡c sá»­ dá»¥ng tools
- Cho phÃ©p chuyá»ƒn license giá»¯a cÃ¡c thiáº¿t bá»‹

ğŸ”§ THÃ€NH PHáº¦N:
- License Server (Laravel API)
- License Client (Python library)
- Device Fingerprinting
- Activation Logging

ğŸ“± DEVICE BINDING:
- 1 License = 1 Device duy nháº¥t
- Device ID Ä‘Æ°á»£c táº¡o tá»« hardware fingerprint
- CÃ³ thá»ƒ deactivate Ä‘á»ƒ chuyá»ƒn sang device khÃ¡c

================================================================================
2. âš™ï¸ CÃCH HOáº T Äá»˜NG Cá»¦A LICENSE
================================================================================

ğŸ”„ WORKFLOW:
1. User mua tool â†’ License Ä‘Æ°á»£c táº¡o tá»± Ä‘á»™ng
2. User nháº­n license key (format: XXXX-XXXX-XXXX-XXXX)
3. Tool gá»i API verify â†’ Bind vá»›i device
4. Má»—i láº§n cháº¡y tool â†’ Verify license
5. Náº¿u invalid â†’ Tool dá»«ng hoáº¡t Ä‘á»™ng

ğŸ”‘ LICENSE STATES:
- INACTIVE: ChÆ°a Ä‘Æ°á»£c kÃ­ch hoáº¡t
- ACTIVE: Äang hoáº¡t Ä‘á»™ng trÃªn device
- EXPIRED: ÄÃ£ háº¿t háº¡n
- REVOKED: Bá»‹ thu há»“i bá»Ÿi admin

ğŸ“Š DEVICE FINGERPRINT:
- Platform (Windows/Linux/Mac)
- Machine type (x86_64/ARM)
- Processor info
- Hostname
- MAC address (náº¿u cÃ³)

================================================================================
3. ğŸ›’ WORKFLOW Tá»ª TOOL STORE Äáº¾N LICENSE
================================================================================

ğŸ¯ QUY TRÃŒNH HOÃ€N CHá»ˆNH:

1. ğŸ‘¨â€ğŸ’¼ ADMIN THÃŠM TOOL:
   â”œâ”€â”€ VÃ o /admin/tools
   â”œâ”€â”€ Click "ThÃªm Tool Má»›i"
   â”œâ”€â”€ Äiá»n: name, slug, price, description, download_url
   â”œâ”€â”€ Set is_active = true
   â””â”€â”€ Tool xuáº¥t hiá»‡n trong store

2. ğŸ›’ USER MUA TOOL:
   â”œâ”€â”€ VÃ o /tools (cá»­a hÃ ng)
   â”œâ”€â”€ Browse tools, search, filter
   â”œâ”€â”€ Click tool â†’ Xem chi tiáº¿t
   â”œâ”€â”€ Click "Mua ngay" â†’ Payment modal
   â””â”€â”€ ToolOrder Ä‘Æ°á»£c táº¡o vá»›i status PENDING

3. ğŸ’³ THANH TOÃN:
   â”œâ”€â”€ Option 1: Balance payment
   â”‚   â”œâ”€â”€ Check user.balance >= tool.price
   â”‚   â”œâ”€â”€ Trá»« balance ngay láº­p tá»©c
   â”‚   â””â”€â”€ ToolOrder status â†’ COMPLETED
   â”‚
   â””â”€â”€ Option 2: Bank transfer
       â”œâ”€â”€ Generate QR code vá»›i VietcomBank API
       â”œâ”€â”€ User chuyá»ƒn khoáº£n
       â”œâ”€â”€ CheckBankTransactionsJob detect payment
       â””â”€â”€ ToolOrder status â†’ COMPLETED

4. ğŸ”‘ LICENSE Tá»° Äá»˜NG Táº O:
   â”œâ”€â”€ Khi ToolOrder status = COMPLETED
   â”œâ”€â”€ LicenseService.createLicenseForOrder()
   â”œâ”€â”€ Generate unique license_key (XXXX-XXXX-XXXX-XXXX)
   â”œâ”€â”€ License record: user_id, tool_id, license_key
   â””â”€â”€ User nháº­n email vá»›i license_key

5. ğŸ“¥ USER DOWNLOAD & Sá»¬ Dá»¤NG:
   â”œâ”€â”€ User download tool tá»« download_url
   â”œâ”€â”€ Tool chá»©a license_client.py
   â”œâ”€â”€ Tool gá»i client.verify(license_key)
   â”œâ”€â”€ Server verify: tool_id, user_id, device binding
   â””â”€â”€ Tool cháº¡y náº¿u license há»£p lá»‡

ğŸ”— DATABASE RELATIONSHIPS:
```
tools (1) â†â†’ (N) tool_orders â†â†’ (1) licenses
  â†“                â†“                    â†“
tool_id         tool_id            tool_id
name            user_id            user_id
price           amount             license_key
download_url    status             device_id
```

ğŸ’° PRICING & LICENSE:
- Má»—i tool cÃ³ giÃ¡ riÃªng (price, sale_price)
- 1 tool order = 1 license duy nháº¥t
- License lifetime (expires_at = null)
- 1 license = 1 device binding

================================================================================
4. ğŸ TÃCH Há»¢P VÃ€O PYTHON TOOL
================================================================================

ğŸ“¥ BÆ¯á»šC 1: DOWNLOAD LICENSE CLIENT
Táº£i file license_client.py tá»«:
https://ezstream.pro/downloads/license_client.py

ğŸ“¦ BÆ¯á»šC 2: CÃ€I Äáº¶T DEPENDENCIES
pip install requests

ğŸŒ BÆ¯á»šC 3: Cáº¤U HÃŒNH SERVER URL
License client tá»± Ä‘á»™ng detect server URL tá»«:
1. Parameter truyá»n vÃ o: LicenseClient(key, "http://localhost:8000")
2. Environment: EZSTREAM_SERVER_URL=http://localhost:8000
3. Config file: ezstream_config.json {"server_url": "http://localhost:8000"}
4. Default: https://ezstream.pro

ğŸ”§ BÆ¯á»šC 4: TÃCH Há»¢P VÃ€O TOOL

--- CÃ¡ch 1: Basic Integration ---
```python
from license_client import LicenseClient
import sys

def main():
    # License key tá»« user
    LICENSE_KEY = "ABCD-EFGH-IJKL-MNOP"
    
    # Initialize client
    client = LicenseClient(LICENSE_KEY)
    
    # Verify license
    if not client.verify():
        print("âŒ License khÃ´ng há»£p lá»‡! Tool khÃ´ng thá»ƒ cháº¡y.")
        sys.exit(1)
    
    print("âœ… License há»£p lá»‡! Báº¯t Ä‘áº§u cháº¡y tool...")
    
    # Tool code á»Ÿ Ä‘Ã¢y
    run_your_tool()

def run_your_tool():
    # Main functionality cá»§a tool
    print("ğŸš€ Tool Ä‘ang cháº¡y...")
    # Your code here

if __name__ == "__main__":
    main()
```

--- CÃ¡ch 2: Advanced Integration vá»›i Error Handling ---
```python
from license_client import LicenseClient
import sys
import os

class ToolLicenseManager:
    def __init__(self):
        self.license_key = None
        self.client = None
        
    def get_license_key(self):
        """Láº¥y license key tá»« nhiá»u nguá»“n"""
        # Thá»­ tá»« environment variable
        key = os.environ.get('EZSTREAM_LICENSE_KEY')
        if key:
            return key
            
        # Thá»­ tá»« file config
        try:
            with open('license.txt', 'r') as f:
                key = f.read().strip()
                if key:
                    return key
        except:
            pass
            
        # YÃªu cáº§u user nháº­p
        key = input("Nháº­p license key: ").strip()
        return key if key else None
    
    def verify_license(self):
        """Verify license vá»›i retry mechanism"""
        self.license_key = self.get_license_key()
        
        if not self.license_key:
            print("âŒ KhÃ´ng tÃ¬m tháº¥y license key!")
            return False
            
        self.client = LicenseClient(self.license_key)
        
        # Thá»­ verify vá»›i retry
        if self.client.verify_with_retry(max_retries=3):
            print("âœ… License verification thÃ nh cÃ´ng!")
            return True
        else:
            print("âŒ License verification tháº¥t báº¡i!")
            return False
    
    def check_license_periodically(self):
        """Check license status Ä‘á»‹nh ká»³ (optional)"""
        if self.client:
            is_valid, data = self.client.check_status()
            if not is_valid:
                print("âš ï¸ License khÃ´ng cÃ²n há»£p lá»‡!")
                return False
        return True

def main():
    license_manager = ToolLicenseManager()
    
    if not license_manager.verify_license():
        sys.exit(1)
    
    # Tool code
    run_your_tool()

def run_your_tool():
    print("ğŸš€ Tool Ä‘ang cháº¡y...")
    # Your main code here

if __name__ == "__main__":
    main()
```

--- CÃ¡ch 3: GUI Integration (tkinter) ---
```python
import tkinter as tk
from tkinter import messagebox
from license_client import LicenseClient

class LicenseDialog:
    def __init__(self):
        self.license_key = None
        self.verified = False
        
    def show_license_dialog(self):
        root = tk.Tk()
        root.title("EzStream License Verification")
        root.geometry("400x200")
        
        tk.Label(root, text="Nháº­p License Key:", font=("Arial", 12)).pack(pady=10)
        
        entry = tk.Entry(root, width=40, font=("Arial", 10))
        entry.pack(pady=5)
        
        def verify_clicked():
            key = entry.get().strip()
            if not key:
                messagebox.showerror("Lá»—i", "Vui lÃ²ng nháº­p license key!")
                return
                
            client = LicenseClient(key)
            if client.verify():
                self.license_key = key
                self.verified = True
                messagebox.showinfo("ThÃ nh cÃ´ng", "License há»£p lá»‡!")
                root.destroy()
            else:
                messagebox.showerror("Lá»—i", "License khÃ´ng há»£p lá»‡!")
        
        tk.Button(root, text="Verify License", command=verify_clicked, 
                 bg="blue", fg="white", font=("Arial", 10)).pack(pady=10)
        
        root.mainloop()
        return self.verified

def main():
    dialog = LicenseDialog()
    
    if not dialog.show_license_dialog():
        print("âŒ License verification tháº¥t báº¡i!")
        return
    
    print("âœ… Báº¯t Ä‘áº§u cháº¡y tool...")
    run_your_tool()

if __name__ == "__main__":
    main()
```

================================================================================
5. ğŸŒ API ENDPOINTS
================================================================================

ğŸ”— BASE URL: Auto-detected tá»« APP_URL hoáº·c https://ezstream.pro/api

ğŸ“¡ ENDPOINTS:

1. GET /license/config
   - Láº¥y cáº¥u hÃ¬nh API cho Python client
   - Response: {api_base_url, endpoints, timeout, retry_attempts}

2. POST /license/verify
   - Verify vÃ  activate license
   - Body: {license_key, device_id, device_name, device_info}
   - Response: {success, message, data}

3. POST /license/check-status
   - Check license status
   - Body: {license_key, device_id}
   - Response: {success, data: {tool, activated_at, expires_at}}

4. POST /license/deactivate
   - Deactivate license tá»« device
   - Body: {license_key, device_id}
   - Response: {success, message}

ğŸ“Š RESPONSE CODES:
- 200: Success
- 404: License not found
- 403: License expired
- 409: Already activated on another device
- 500: Server error

ğŸ”§ DEVELOPMENT vs PRODUCTION:
- Development: http://localhost:8000/api hoáº·c http://ezstream.test/api
- Production: https://ezstream.pro/api
- Client tá»± Ä‘á»™ng detect tá»« config endpoint

================================================================================
5. âš ï¸ ERROR HANDLING
================================================================================

ğŸš¨ COMMON ERRORS:

1. "License key not found"
   â†’ Kiá»ƒm tra láº¡i license key
   â†’ LiÃªn há»‡ support náº¿u key Ä‘Ãºng

2. "License already activated on another device"
   â†’ Sá»­ dá»¥ng deactivate() trÆ°á»›c
   â†’ Hoáº·c liÃªn há»‡ admin Ä‘á»ƒ transfer

3. "License has expired"
   â†’ Gia háº¡n license
   â†’ Mua license má»›i

4. "Connection error"
   â†’ Kiá»ƒm tra internet
   â†’ Thá»­ láº¡i sau

5. "Device fingerprint changed"
   â†’ Hardware thay Ä‘á»•i
   â†’ Deactivate vÃ  activate láº¡i

ğŸ”§ ERROR HANDLING CODE:
```python
def safe_license_verify(license_key):
    try:
        client = LicenseClient(license_key)
        return client.verify()
    except ConnectionError:
        print("âŒ KhÃ´ng thá»ƒ káº¿t ná»‘i server. Kiá»ƒm tra internet.")
        return False
    except TimeoutError:
        print("âŒ Timeout. Thá»­ láº¡i sau.")
        return False
    except Exception as e:
        print(f"âŒ Lá»—i khÃ´ng xÃ¡c Ä‘á»‹nh: {e}")
        return False
```

================================================================================
6. ğŸ’¡ BEST PRACTICES
================================================================================

âœ… DO:
- Verify license ngay khi tool start
- Cache license status trong session
- Implement retry mechanism
- Show clear error messages
- Log license events
- Handle offline scenarios gracefully

âŒ DON'T:
- Hard-code license keys
- Skip error handling
- Verify quÃ¡ thÆ°á»ng xuyÃªn (spam API)
- Store sensitive data locally
- Ignore connection errors

ğŸ”’ SECURITY:
- KhÃ´ng lÆ°u license key trong code
- Sá»­ dá»¥ng environment variables
- Encrypt license file náº¿u cáº§n
- Validate input tá»« user

âš¡ PERFORMANCE:
- Cache verification result
- Timeout cho API calls
- Async verification náº¿u cÃ³ thá»ƒ
- Minimize API calls

================================================================================
7. ğŸ”§ TROUBLESHOOTING
================================================================================

â“ COMMON ISSUES:

Q: Tool bÃ¡o "License invalid" nhÆ°ng key Ä‘Ãºng?
A: - Kiá»ƒm tra internet connection
   - Thá»­ deactivate vÃ  activate láº¡i
   - LiÃªn há»‡ support vá»›i device info

Q: KhÃ´ng thá»ƒ activate trÃªn mÃ¡y má»›i?
A: - Deactivate tá»« mÃ¡y cÅ© trÆ°á»›c
   - Hoáº·c liÃªn há»‡ admin Ä‘á»ƒ transfer
   - Check hardware fingerprint

Q: License hoáº¡t Ä‘á»™ng rá»“i bá»—ng dÆ°ng khÃ´ng Ä‘Æ°á»£c?
A: - Hardware cÃ³ thá»ƒ Ä‘Ã£ thay Ä‘á»•i
   - License cÃ³ thá»ƒ bá»‹ revoke
   - Check expiration date

Q: API response cháº­m?
A: - Implement timeout (30s)
   - Sá»­ dá»¥ng retry mechanism
   - Cache result khi cÃ³ thá»ƒ

ğŸ› ï¸ DEBUG COMMANDS:
```bash
# Test license tá»« command line
python license_client.py "YOUR-LICENSE-KEY" verify

# Check status
python license_client.py "YOUR-LICENSE-KEY" status

# Deactivate
python license_client.py "YOUR-LICENSE-KEY" deactivate
```

ğŸ“ SUPPORT:
- Email: support@ezstream.com
- Discord: EzStream Community
- Docs: https://docs.ezstream.com

================================================================================
ğŸ¯ Káº¾T LUáº¬N
================================================================================

License system giÃºp báº£o vá»‡ tools vÃ  quáº£n lÃ½ users hiá»‡u quáº£. 
TÃ­ch há»£p Ä‘Ãºng cÃ¡ch sáº½ Ä‘áº£m báº£o:
- Báº£o máº­t cao
- User experience tá»‘t  
- Dá»… maintenance
- Scalable

HÃ£y follow best practices vÃ  test ká»¹ trÆ°á»›c khi deploy!

ğŸš€ Happy Coding!
================================================================================
